@if (appointments(); as appointments) {
    <div class="cp-content flex flex-col flex-1 justify-between gap-6 mt-8">
        <div class="overflow-hidden flex flex-col gap-4 flex-1">
            <div class="flex flex-row m-2 justify-between items-center">
                <h2 style="font-weight: bold">{{ 'COMMON.APPOINTMENTS' | translate }}</h2>
                @if (authService.hasRole(Role.ADMIN_SYSTEM)) {
                    <button mat-raised-button (click)="addFreeAppointments()">
                        <mat-icon>add</mat-icon>
                        {{ 'COMMON.ADD_APPOINTMENT' | translate }}
                    </button>
                }
            </div>
            <mat-card class="flow-row ">
                <div class="flex-column items-start m-4">
                    <app-filter-appointment (searchClicked)="searchClicked($event)" (dateRange)="setDateRange($event)"></app-filter-appointment>
                </div>
            </mat-card>
            @if (appointments.length) {
                <table mat-table [dataSource]="appointments.length ? appointments : placeHodler" class="mat-elevation-z8">
                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef>{{ 'COMMON.DATE' | translate }}</th>
                        <td mat-cell *matCellDef="let appointment"> {{ appointment.dateAndTime | date: 'medium' }}</td>
                    </ng-container>

                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef> {{ 'COMMON.APPOINTMENT_STATUS' | translate }}</th>
                        <td mat-cell *matCellDef="let appointment"> {{ appointment.appointementStatus !== null ? ('COMMON.APPOINTMENT_STATUS_' + appointment.appointmentStatus | translate) : '-' }}</td>
                    </ng-container>

                    <ng-container matColumnDef="hospital">
                        <th mat-header-cell *matHeaderCellDef> {{ 'COMMON.HOSPITAL' | translate }}</th>
                        <td mat-cell *matCellDef="let appointment"> {{ appointment.hospital?.name }}</td>
                    </ng-container>

                    <ng-container matColumnDef="duration">
                        <th mat-header-cell *matHeaderCellDef> {{ 'COMMON.DURATION' | translate }}</th>
                        <td mat-cell *matCellDef="let appointment"> {{ appointment.duration !== null ? (appointment.duration + ' min') : '-' }}</td>
                    </ng-container>

                    <ng-container matColumnDef="doctor">
                        <th mat-header-cell *matHeaderCellDef> {{ 'COMMON.DOCTORS' | translate }}</th>
                        <td mat-cell *matCellDef="let appointment"> {{ appointment.doctor !== null ? appointment.doctor.firstName : '-' }}</td>
                    </ng-container>

                    <ng-container matColumnDef="patient">
                        <th mat-header-cell *matHeaderCellDef> {{ 'COMMON.PATIENT' | translate }}</th>
                        <td mat-cell *matCellDef="let appointment"> {{ appointment.patient != null ? appointment.patient.firstName : '-' }}</td>
                    </ng-container>
                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let appointment">
                            @if (authService.hasRole(Role.DOCTOR) && appointment.appointmentStatus === AppointmentStaus.SCHEDULED) {
                                <button mat-icon-button (click)="approve(appointment.id)">
                                    <mat-icon svgIcon="check_circle">
                                    </mat-icon>
                                </button>
                                <button mat-icon-button (click)="deny(appointment.id)">
                                    <mat-icon svgIcon="cancel">
                                    </mat-icon>
                                </button>
                            } @else if (authService.hasRole(Role.PATIENT) && appointment.appointmentStatus === AppointmentStaus.OPEN) {
                                <button mat-icon-button (click)="schedule(appointment.id)">
                                    <mat-icon svgIcon="schedule">
                                    </mat-icon>
                                </button>
                            } @else if (appointment.appointmentStatus === AppointmentStaus.FINISHED) {
                                <button mat-icon-button (click)="downloadReport(appointment.id)" [matTooltip]="'COMMON.DOWNLOAD_APPOINTMENT_REPORT' | translate">
                                    <mat-icon svgIcon="file_save">
                                    </mat-icon>
                                </button>
                                <button mat-icon-button (click)="downloadPrescription(appointment.id)" [matTooltip]="'COMMON.DOWNLOAD_APPOINTMENT_PRESCRIPTION' | translate">
                                    <mat-icon svgIcon="file_save">
                                    </mat-icon>
                                </button>
                            }
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
            }
        </div>
    </div>
}
